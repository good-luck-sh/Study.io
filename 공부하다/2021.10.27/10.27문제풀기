-- 모든 직원의 이름, 소속부서 아이디, 소속부서 이름을 조회하기 
SELECT E.FIRST_NAME, E.DEPARTMENT_ID, D.DEPARTMENT_NAME
FROM EMPLOYEES E, DEPARTMENTS D
WHERE E.DEPARTMENT_ID = D.DEPARTMENT_ID(+);
--60번 부서에 소속된 직원의 이름, 업무아이디, 업무제목을 조회하기 
SELECT E.FIRST_NAME, E.JOB_ID, J.JOB_TITLE
FROM EMPLOYEES E, JOBS J
WHERE E.DEPARTMENT_ID = 60
AND E.JOB_ID = J.JOB_ID;

--100번 직원이 근무하고 있는 도시의 이름을 조회하기 
SELECT L.CITY
FROM EMPLOYEES E, DEPARTMENTS D, LOCATIONS L
WHERE E.EMPLOYEE_ID = 100
AND E.DEPARTMENT_ID = D.DEPARTMENT_ID
AND D.LOCATION_ID = L.LOCATION_ID;

--커미션을 받는 직원의 이름, 부서이름, 급여, 커미션, 연봉을 조회하기 
SELECT E.FIRST_NAME, D.DEPARTMENT_NAME, E.SALARY, E.COMMISSION_PCT, E.SALARY*12+E.SALARY*12*E.COMMISSION_PCT ANNUAL_SALARY
FROM EMPLOYEES E, DEPARTMENTS D
WHERE E.COMMISSION_PCT IS NOT NULL
AND E.DEPARTMENT_ID = D.DEPARTMENT_ID(+)
ORDER BY ANNUAL_SALARY DESC;

-- 커미션을 받지 않는 직원의 이름, 부서이름, 급여, 급여 등급을 조회하기
SELECT E.FIRST_NAME, D.DEPARTMENT_NAME, E.SALARY, S.GRADE
FROM EMPLOYEES E, DEPARTMENTS D, SALARY_GRADE S
WHERE E.COMMISSION_PCT IS NULL
AND E.DEPARTMENT_ID = D.DEPARTMENT_ID
AND E.SALARY >= S.MIN_SALARY AND E.SALARY <= S.MAX_SALARY;
-- 'Toronto'에서 근무하는 모든 직원의 이름, 직종아이디, 부서아이디, 부서이름을 조회하기
SELECT E.FIRST_NAME, E.JOB_ID, E.DEPARTMENT_ID, D.DEPARTMENT_NAME 
FROM EMPLOYEES E, DEPARTMENTS D, LOCATIONS L
WHERE L.CITY = 'Toronto'
AND E.DEPARTMENT_ID = D.DEPARTMENT_ID
AND D.LOCATION_ID = L.LOCATION_ID;

-- 급여등급이 'D'인 직원들의 이름, 직종아이디, 급여를 조회하기
SELECT E.FIRST_NAME, E.JOB_ID, E.SALARY
FROM EMPLOYEES E, SALARY_GRADE S
WHERE S.GRADE = 'D'
AND E.SALARY >= S.MIN_SALARY AND E.SALARY <= S.MAX_SALARY
ORDER BY 3 DESC;

-- 50번과 80번 부서에 소속된 직원들의 아이디, 이름, 매니저 아이디, 매니저 이름을 조회하기
SELECT EP.EMPLOYEE_ID EP_ID, EP.FIRST_NAME EP_NAME, EP.MANAGER_ID EP_MANAGER_ID, MP.FIRST_NAME EP_MANAGER_NAME
FROM EMPLOYEES EP, EMPLOYEES MP
WHERE EP.DEPARTMENT_ID IN(50,80)
AND EP.MANAGER_ID = MP.EMPLOYEE_ID;

-- 자신의 매니저보다 먼저 입사한 직원들의 이름, 자신의 입사일, 매니저 이름, 매니저의 입사일을 조회하기
SELECT EP.FIRST_NAME EP_NAME, EP.HIRE_DATE EP_HIRE_DATE, MP.FIRST_NAME EP_MANAGER_NAME, MP.HIRE_DATE EP_MANAGER_HIRE_DATE
FROM EMPLOYEES EP, EMPLOYEES MP
WHERE EP.HIRE_DATE > MP.HIRE_DATE
AND EP.MANAGER_ID = MP.EMPLOYEE_ID
ORDER BY 2 ;
-- 직원중에서 자신이 담당하고 있는 직종의 최저급여와 최고급여의 평균보다 급여를 더 많이 받는 사원의 이름, 직종아이디, 급여, 그 직종의 평균급여를 조회하기
SELECT E.FIRST_NAME, E.JOB_ID, E.SALARY , AVG(J.MIN_SALARY + J.MAX_SALARY/2 ) AS AVERAGE_SALARY, 
AVG(J.MIN_SALARY) AS MIN_AVERAGE, AVG(J.MAX_SALARY) AS MAX_AVERAGE 
FROM EMPLOYEES E, JOBS J
GROUP BY J.MIN_SALARY, J.MAX_SALARY, E.FIRST_NAME, E.JOB_ID, E.SALARY 
HAVING E.SALARY > AVG(J.MIN_SALARY) AND E.SALARY > AVG(J.MAX_SALARY) 
ORDER BY 3;
-- 자신의 직종이 변경된 적이 있는 직원들의 직원아이디, 변경전 직종아이디, 변경전 소속부서명, 현재 직종아이디, 현재 소속부서명을 조회하기
SELECT H.EMPLOYEE_ID, H.JOB_ID, D1.DEPARTMENT_NAME, E.JOB_ID, D2.DEPARTMENT_NAME
FROM JOB_HISTORY H, EMPLOYEES E, DEPARTMENTS D1, DEPARTMENTS D2
WHERE H.EMPLOYEE_ID = E.EMPLOYEE_ID
AND H.EMPLOYEE_ID = E.EMPLOYEE_ID
AND H.DEPARTMENT_ID = D1.DEPARTMENT_ID
AND E.DEPARTMENT_ID = D2.DEPARTMENT_ID
ORDER BY H.EMPLOYEE_ID ASC;

-- 이전에 'Executive' 부서에 근무한 적이 있는 직원의 이름, 현재 직종아이디, 현재 소속부서명을 조회하기
SELECT DISTINCT E.FIRST_NAME, E.JOB_ID, D1.DEPARTMENT_NAME
FROM DEPARTMENTS D1, EMPLOYEES E, JOB_HISTORY H, DEPARTMENTS D2
WHERE D2.DEPARTMENT_NAME = 'Executive'
AND H.EMPLOYEE_ID = E.EMPLOYEE_ID
AND E.DEPARTMENT_ID = D1.DEPARTMENT_ID
AND H.DEPARTMENT_ID = D2.DEPARTMENT_ID;

-- 2006년에 50번부서에서 근무한 적이 있는 직원의 아이디, 이름을 조회하기
SELECT E.EMPLOYEE_ID, E.FIRST_NAME
FROM EMPLOYEES E, JOB_HISTORY H
WHERE H.DEPARTMENT_ID = 50 
AND H.START_DATE >= '2006/01/01' AND H.START_DATE <= TO_DATE('2006/12/31')+1
AND E.EMPLOYEE_ID = H.EMPLOYEE_ID;

-- 모든 직원들을 직종아이디별로 나누었을 때 직종아이디별 사원수를 조회하기
SELECT JOB_ID, COUNT(*) AS EMPLOYEE_NUMBER
FROM EMPLOYEES  
GROUP BY JOB_ID
ORDER BY 1;

-- 직원들을 급여등급을 기준으로 그룹화했을 때 급여등급별 인원수를 조회하기
SELECT S.GRADE, COUNT(*)
FROM EMPLOYEES E, SALARY_GRADE S
WHERE E.SALARY >= S.MIN_SALARY AND E.SALARY <= S.MAX_SALARY
GROUP BY S.GRADE
ORDER BY 1 ASC;

-- 직원들을 부서명을 기준으로 그룹화했을 때 각 부서별 최저급여, 최고급여, 평균급여를 조회하기
SELECT D.DEPARTMENT_NAME, ROUND(AVG(J.MIN_SALARY)) AS MIN_SALARY, ROUND(AVG(J.MAX_SALARY)) AS MAX_SALARY, ROUND(AVG(J.MIN_SALARY+J.MAX_SALARY/2)) AS AVERAGE_SALARY 
FROM EMPLOYEES E, DEPARTMENTS D, JOBS J
WHERE E.DEPARTMENT_ID = D.DEPARTMENT_ID
AND E.JOB_ID = J.JOB_ID
GROUP BY D.DEPARTMENT_NAME
ORDER BY 4 DESC;


-- 50번과 80번 부서에 소속된 직원들의 급여등급별 인원수를 조사했을 때 해당 등급의 인원수가 3명이상인 등급과, 인원수를 조회하기
SELECT S.GRADE, COUNT(*) AS PEOPLE
FROM EMPLOYEES E, SALARY_GRADE S
WHERE E.DEPARTMENT_ID IN(50,80)
AND E.SALARY >= S.MIN_SALARY AND E.SALARY <= S.MAX_SALARY
GROUP BY S.GRADE
HAVING COUNT(*) > 3
ORDER BY 1;